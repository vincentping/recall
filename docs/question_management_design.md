# 题库管理系统设计方案
## 单选/多选题型专用版

---

## 一、现状分析

### 1.1 现有功能

| 模块 | 功能 | 实现状态 |
|------|------|---------|
| **题目录入** | 单题录入（InputWindow） | ✅ 已实现 |
| **批量导入** | 从 Markdown 批量导入（BatchImportWindow） | ✅ 已实现 |
| **题目管理** | 编辑/删除题目（QuestionManagerWindow） | ✅ 已实现 |
| **考试管理** | 多考试切换、模块/章节 CRUD（ExamManager） | ✅ 已实现 |
| **练习模式** | 学习模式 + 考试模拟（PracticeWindow） | ✅ 已实现 |
| **成绩追踪** | 练习记录、正确率统计（HomePage） | ✅ 已实现 |
| **多语言** | 中英文切换 | ✅ 已实现 |
| **主题系统** | 默认/暗色主题 + 字体大小 | ✅ 已实现 |

### 1.2 现有数据库结构

```
核心表：
- Knowledge_Modules    # 知识模块
- Lessons             # 章节/课时
- Questions           # 题目主表（含 question_type, is_flagged）
- Answers             # 选项表
- Question_Usage      # 题目归属关系
- UserSettings        # 用户设置（含 exam_name）
- Practice_Sessions   # 练习会话记录
- Answer_Records      # 单题作答记录
```

### 1.3 存在的问题

- ❌ **代码重复**：InputWindow（新建）和 QuestionEditDialog（编辑）功能重复
- ❌ **效率低下**：缺少批量操作，逐个处理题目耗时
- ❌ **组织困难**：只能按章节分类，缺少灵活的标签系统
- ❌ **质量难控**：没有质量检查工具，容易出现数据错误
- ❌ **统计缺失**：不清楚题库整体状况和覆盖度
- ❌ **导出受限**：只能通过数据库查看，无法导出为 PDF/Word

---

## 二、改进方案总览

### 2.1 功能模块架构

```
题库管理改进
│
├── 📝 题目编辑模块
│   ├── 统一编辑器（新建+编辑）         ⭐ P0
│   └── 快速编辑（列表内直接修改）      ⭐ P2
│
├── 🔧 批量操作模块
│   ├── 批量标记/删除/移动              ⭐ P0
│   ├── 批量添加标签                   ⭐ P1
│   └── 批量修改难度                   ⭐ P2
│
├── 🏷️ 组织分类模块
│   ├── 标签系统                       ⭐ P1
│   ├── 难度等级                       ⭐ P1
│   └── 题目来源标记                   ⭐ P2
│
├── ✅ 质量管理模块
│   ├── 质量检查工具                   ⭐ P1
│   └── 重复题目检测                   ⭐ P1
│
├── 📊 统计分析模块
│   ├── 题库统计仪表板                 ⭐ P1
│   └── 覆盖度分析                     ⭐ P1
│
├── 📤 导入导出模块
│   ├── 导出为 PDF（带/不带答案）      ⭐ P1
│   ├── 导出为 Word/Markdown           ⭐ P1
│   ├── 导出为 Excel                   ⭐ P2
│   └── 从 Excel/CSV/JSON 导入导出     ⭐ P2
│
└── 🔍 搜索筛选模块
    ├── 全文搜索（题干+选项+解析）     ⭐ P1
    └── 高级筛选器                     ⭐ P1
```

---

## 三、详细设计方案

### 3.1 统一编辑器（P0）

合并 InputWindow（新建）和 QuestionEditDialog（编辑）为一个统一对话框。

**界面布局**：
```
┌────────────────────────────────────────────────┐
│  新建题目 / 编辑题目 #123                       │
├────────────────────────────────────────────────┤
│  【归属信息】                                   │
│  知识模块: [Core 1 ▼]    章节: [1.1 CPU ▼]    │
│  题目类型: [单选题 ▼]    选项数: [4 ▼]         │
│  重点标记: ☐ 标记为重点                         │
│  难度等级: [中等 ▼]     标签: [#硬件] [+ 添加]  │
├────────────────────────────────────────────────┤
│  【题目内容】                                   │
│  题干: [____________________________________]  │
│  解析: [____________________________________]  │
├────────────────────────────────────────────────┤
│  【选项】                                       │
│  A. [选项文本] ○ 正确                          │
│  B. [选项文本] ○ 正确                          │
│  C. [选项文本] ○ 正确                          │
│  D. [选项文本] ○ 正确                          │
├────────────────────────────────────────────────┤
│                      [保存] [取消]              │
└────────────────────────────────────────────────┘
```

**实现要点**：
- `question_id=None` 为新建模式，否则为编辑模式
- 题型切换时自动更新选项控件（单选 RadioButton ↔ 多选 CheckBox）
- 选项数量动态调整（2-8 个）
- 实时验证：题干非空、至少 2 个选项、至少 1 个正确答案

---

### 3.2 批量操作（P0）

改造 QuestionManagerWindow，添加复选框支持批量操作。

```
┌────────────────────────────────────────────────┐
│  题目管理                                       │
├────────────────────────────────────────────────┤
│  筛选: [模块 ▼] [章节 ▼] [标签 ▼] [难度 ▼]    │
│  搜索: [_______________] [搜索]                │
├────────────────────────────────────────────────┤
│  已选择 5 个题目:                               │
│  [批量标记] [批量删除] [批量移动] [批量标签]   │
├────────────────────────────────────────────────┤
│  ☐ ID  题目预览          类型  难度  标签  操作 │
│  ☑ 1   以下哪个是CPU... MC   中   #硬件 [编辑]│
│  ☐ 2   RAM的作用是...   MC   易   #硬件 [编辑]│
│  ☑ 3   以下哪些是...    MR   难   #网络 [编辑]│
│  ...                                           │
├────────────────────────────────────────────────┤
│  共 250 题  第 1/5 页  [上一页] [下一页]       │
└────────────────────────────────────────────────┘
```

| 操作 | 功能 | 实现方式 |
|------|------|---------|
| 批量标记 | 标记/取消标记为重点 | 更新 `is_flagged` |
| 批量删除 | 删除选中题目 | 调用 `db.delete_question()` |
| 批量移动 | 移动到其他章节 | 更新 `Question_Usage` |
| 批量标签 | 添加/移除标签 | 更新 `tags` 字段 |
| 批量难度 | 设置难度等级 | 更新 `difficulty` 字段 |

---

### 3.3 标签系统（P1）

**数据库设计（推荐简单方案）**：
```sql
ALTER TABLE Questions ADD COLUMN tags TEXT DEFAULT '';
-- 存储格式: "硬件,CPU,高频考点"（逗号分隔）
```

**标签预设**：
- 知识点：#硬件 #主板 #CPU #内存 #网络 #TCP/IP #操作系统 #安全
- 属性：#高频考点 #易错题 #重点 #概念题 #操作题
- 来源：#官方题库 #模拟题 #真题回忆

---

### 3.4 难度等级（P1）

```sql
ALTER TABLE Questions ADD COLUMN difficulty INTEGER DEFAULT 3;
-- 1=很简单, 2=简单, 3=中等, 4=困难, 5=很困难
```

显示方式：颜色 + 文字（🟢简单 🟡中等 🟠困难 🔴很困难）

---

### 3.5 质量检查工具（P1）

自动检测题库中的数据质量问题：

| 检查项 | 级别 | 说明 |
|--------|------|------|
| 题干为空 | 严重 | 题目必须有题干 |
| 选项少于 2 个 | 严重 | 至少需要 2 个选项 |
| 无正确答案 | 严重 | 必须标记正确答案 |
| 单选题有多个答案 | 严重 | MC 题型只能有 1 个正确答案 |
| 多选题只有 1 个答案 | 警告 | MR 题型应该有多个正确答案 |
| 解析缺失 | 警告 | 建议添加解析 |
| 选项文本重复 | 警告 | 存在完全相同的选项 |

提供一键跳转到问题题目、批量删除、导出报告功能。

---

### 3.6 重复题目检测（P1）

| 级别 | 检测方式 | 说明 |
|------|---------|------|
| 完全重复 | 题干完全相同 | 应该删除 |
| 高度相似 | 相似度 > 90%（difflib） | 可能是措辞不同的同一题 |
| 疑似重复 | 相似度 > 70% | 需人工判断 |

---

### 3.7 统计仪表板（P1）

展示内容：
- 总题数、单选/多选分布、重点题数、有/无解析比例
- 按模块/章节统计题目数量
- 按难度分布统计（实现难度字段后）
- 热门标签（实现标签系统后）
- 覆盖度分析：每章是否达到建议题数（≥ 10 题）

---

### 3.8 导入导出（P1-P2）

**PDF 导出**（P1）：
- 范围：全部 / 当前筛选 / 选中题目 / 指定章节
- 内容：题干、选项、正确答案、解析（可选）
- 版本：教师版（含答案）/ 学生版
- 使用 reportlab 库

**Markdown / Word 导出**（P1）：
- Markdown 原生格式，Word 使用 python-docx

**Excel 导入导出**（P2）：
- 使用 openpyxl，一行一题格式
- 导入时：字段映射 → 预览 → 验证 → 导入

**JSON 导入导出**（P2）：
- 完整结构保留，适合备份和系统间数据交换

---

### 3.9 全文搜索与高级筛选（P1）

- 搜索范围：题干 + 选项 + 解析
- 支持大小写敏感、全词匹配
- 筛选维度：模块、章节、题型、难度、标签、重点标记、来源
- 可保存常用筛选方案（P2）

---

## 四、数据库迁移

### 4.1 新增字段

```sql
ALTER TABLE Questions ADD COLUMN difficulty INTEGER DEFAULT 3;
ALTER TABLE Questions ADD COLUMN tags TEXT DEFAULT '';
ALTER TABLE Questions ADD COLUMN source TEXT DEFAULT 'custom';
ALTER TABLE Questions ADD COLUMN created_at DATETIME DEFAULT CURRENT_TIMESTAMP;
ALTER TABLE Questions ADD COLUMN updated_at DATETIME DEFAULT CURRENT_TIMESTAMP;
```

### 4.2 迁移脚本

```sql
UPDATE Questions SET difficulty = 3 WHERE difficulty IS NULL;
UPDATE Questions SET tags = '' WHERE tags IS NULL;
UPDATE Questions SET source = 'custom' WHERE source IS NULL;
```

---

## 五、实施计划

### Phase 1: 核心功能完善（P0）
| 任务 | 工作量 |
|------|--------|
| 统一编辑器 | 2-3 小时 |
| 批量操作（删除、标记、移动） | 2 小时 |
| 数据库字段扩展（难度、标签） | 0.5 小时 |

### Phase 2: 组织与质量（P1）
| 任务 | 工作量 |
|------|--------|
| 标签系统 | 3-4 小时 |
| 难度等级 | 1-2 小时 |
| 质量检查工具 | 3-4 小时 |
| 重复检测 | 2-3 小时 |
| 统计仪表板 | 2-3 小时 |
| 全文搜索 | 1-2 小时 |

### Phase 3: 导入导出（P1-P2）
| 任务 | 工作量 |
|------|--------|
| 导出 PDF | 4-6 小时 |
| 导出 Word/Markdown | 2-3 小时 |
| 导出 Excel | 2 小时 |
| 从 Excel/CSV 导入 | 3-4 小时 |
| JSON 导入/导出 | 1-2 小时 |

### Phase 4: 优化改进（P2）
| 任务 | 工作量 |
|------|--------|
| 题目来源标记 | 1 小时 |
| 保存的筛选方案 | 2 小时 |
| 快速编辑 | 2 小时 |

---

## 六、技术选型

| 功能 | 推荐库 |
|------|--------|
| PDF 导出 | reportlab |
| Word 导出 | python-docx |
| Excel 导入/导出 | openpyxl |
| 文本相似度 | difflib（内置） |
| 图表（可选） | matplotlib |
